<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Fragments - Reassembly Modding by Example</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Reassembly Modding by Example</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="fragments"><a class="header" href="#fragments">Fragments</a></h1>
<p>When a bullet is destroyed, it can produce fragments. These fragments can also produce fragments when they are destroyed, creating one of the most versatile systems in Reassembly modding.</p>
<p>Fragments are nested within projectile code and have the same field types as base cannons except for those which wouldn't make sense.</p>
<p>Look at the code below and look at the similarities between the base cannon bullet and the fragment which is nested within it:</p>
<pre><code class="language-lua">{ 17000
    features=CANNON
    cannon={
        damage=100
        roundsPerSec=5
        muzzleVel=1000
        range=1000
        power=10
        spread=0.1
        color=0xFFFFFFFF
        recoil=1

        burstyness=1
        roundsPerBurst=5

        explosive=ENABLED
        explodeRadius=50

        fragment={
            damage=50
            -- Fragments don't have `roundsPerSec`.
            muzzleVel=500
            range=500
            -- Fragments don't need `power`.
            spread=0.1
            color=0xFFFFFFFF
            -- Fragments have no need to exert `recoil`.

            -- Fragments also don't have `burstyness`.
            roundsPerBurst=5

            explosive=ENABLED
            explodeRadius=25
        }
    }
}
</code></pre>
<p>In fragments, <code>roundsPerBurst</code> is repurposed as the amount of fragments released when a bullet is destroyed.</p>
<p>In the code extract above, the base cannon bullet will split into 5 fragments, which are all identical. The fragments will also be created at a spread of 0.1 radians, or ~5.72Â°, as defined by the fragment's <code>spread</code> field.</p>
<video  controls>
  <source src="diagrams/fragment_first_example.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<h2 id="fragment-chaining"><a class="header" href="#fragment-chaining">Fragment Chaining</a></h2>
<p>As fragments can be nested within each other, we can create fragment chains. Below is an example of one using conventional one-line fragments for easy reading:</p>
<pre><code class="language-lua">{ 17000
    features=CANNON
    cannon={
        damage=100
        roundsPerSec=1
        muzzleVel=50
        range=50
        power=10
        -- Some fields have been left out for ease of explaining.

        fragment={ damage=100 muzzleVel=50 range=50 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=50 range=50 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=50 range=50 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=50 range=50 roundsPerBurst=1
        }}}} -- Closing brackets are lined up at the end of the chain.
    }
}
</code></pre>
<p>In this code extract, there will be 5 fragment projectiles that spawn after one another in a chain.</p>
<h2 id="the-relationship-of-range-and-muzzlevel"><a class="header" href="#the-relationship-of-range-and-muzzlevel">The Relationship of <code>range</code> and <code>muzzleVel</code></a></h2>
<p>If you fire the cannon from the code extract above, you might notice something unexpected if you are unfamilier with fragment modding. Each new fragment is faster than the last by 50 units per second:</p>
<video  controls>
  <source src="diagrams/fragment_chain_speeding_up.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<p>This is caused by each successive fragment inheriting the sum of the velocities of all the bullets that came before it.
To have uniform velocities on the bullets, one might expect the solution to be to make the <code>muzzleVel</code> equal 0, but this does not work:
<video  controls>
<source src="diagrams/fragment_chain_going_on.mp4" type="video/mp4">
Your browser does not support the video tag.
</video></p>
<pre><code class="language-lua">    cannon={
        damage=100
        roundsPerSec=1
        muzzleVel=50
        range=50
        power=10

        fragment={ damage=100 muzzleVel=0 range=50 roundsPerBurst=1
        -- None of the other fragments are reached.
        fragment={ damage=100 muzzleVel=0 range=50 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=0 range=50 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=0 range=50 roundsPerBurst=1
        }}}}
    }
</code></pre>
<p>Although the second bullet has velocity, it is inherited from the first stage. Think back to how bullet duration is calculated based on only a bullet's <code>muzzleVel</code> and <code>range</code>, not its current velocity.</p>
<p>Now, understand that the second bullet will never transition to the third stage as the second bullet is "attempting" to travel a <code>range</code> of 50 at a <code>muzzleVel</code> of 0. The journey to travel 50 units at 0 units per second is uncompletable, the bullet will never enter the third stage.</p>
<p>To achieve uniform velocities, we must make the <code>muzzleVel</code> unnoticably small as well setting its <code>range</code> small enough that the fragments' duration is calculated to not be infinite.</p>
<p>If we want the fragments to last for one second, similar to the base bullet, then we can set <code>range</code> to 1 and the <code>muzzleVel</code> to 1. The bullet will travel 1 unit at 1 unit per second over a time of 1 second.</p>
<video  controls>
  <source src="diagrams/fragment_chain_uniform_velocity.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<pre><code class="language-lua">    cannon={
        damage=100
        roundsPerSec=1
        muzzleVel=50
        range=50
        power=10

        fragment={ damage=100 muzzleVel=1 range=1 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=1 range=1 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=1 range=1 roundsPerBurst=1
        fragment={ damage=100 muzzleVel=1 range=1 roundsPerBurst=1
		-- All fragments occur. success!
        }}}}
    }
</code></pre>
<p>Strangely, a bullet trying to travel a <code>range</code> of 0 at a <code>muzzleVel</code> of 0 completes its journey.</p>
<h2 id="patterns"><a class="header" href="#patterns">Patterns</a></h2>
<p>For more control over how bullets are spawned, you can select various pattern flags for the <code>pattern</code> field of a bullet. They can be used in both base bullets and fragments.</p>
<p>Below is an example of a cannon using the <code>RANDOM</code> pattern, which would be the same as having <code>pattern</code> not defined.</p>
<pre><code class="language-lua">    cannon={
        damage=100
        roundsPerSec=1
        muzzleVel=50
        range=50
        power=10
        recoil=0

        spread=pi*2
        pattern=RANDOM
    }
</code></pre>
<p>Below are all the bullet patterns, they can all be used on both base cannon bullets and fragments except for <code>WAVE</code>, which can only be used on base cannon bullets.</p>
<h3 id="random"><a class="header" href="#random">Random</a></h3>
<p><code>pattern=RANDOM</code>: default spread behaviour, choosing a random angle in the specified spread.</p>
<pre><code class="language-lua">	cannon={ spread=pi*2 pattern=RANDOM

        damage=100 roundsPerSec=5 muzzleVel=50 range=50 recoil=0 }
</code></pre>
<video height=256 controls>
  <source src="diagrams/fragment_pattern_random.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<h3 id="constant"><a class="header" href="#constant">Constant</a></h3>
<p><code>pattern=CONSTANT</code>: bullet will angle exactly at the spread angle. Positive <code>spread</code> angles bullet counterclockwise while negative <code>spread</code> angles bullets clockwise.</p>
<p>Firing counterclockwise:</p>
<pre><code class="language-lua">   cannon={ spread=pi*0.5 pattern=CONSTANT

       damage=100 roundsPerSec=5 muzzleVel=50 range=50 recoil=0 }
</code></pre>
<video height=256 controls>
  <source src="diagrams/fragment_pattern_constant_positive.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<p>Firing clockwise:</p>
<pre><code class="language-lua">   cannon={ spread=pi*-0.5 pattern=CONSTANT

       damage=100 roundsPerSec=5 muzzleVel=50 range=50 recoil=0 }
</code></pre>
<video height=256 controls>
  <source src="diagrams/fragment_pattern_constant_negative.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<h3 id="spiral"><a class="header" href="#spiral">Spiral</a></h3>
<p><code>pattern=SPIRAL</code>: bullets are evenly distributed within the spread angle. Needs <code>roundsPerBurst</code> and <code>burstyness</code> defined on base cannon bullets but only needs <code>roundsPerBurst</code> defined on fragments.</p>
<pre><code class="language-lua">   cannon={ spread=pi*0.5 pattern=SPIRAL roundsPerBurst=5 burstyness=0.5

       damage=100 roundsPerSec=5 muzzleVel=50 range=50 recoil=0 }
</code></pre>
<video height=256 controls>
  <source src="diagrams/fragment_pattern_spiral.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<h3 id="wave"><a class="header" href="#wave">Wave</a></h3>
<p><code>pattern=WAVE</code>: bullets are distributed according to a sine wave within the spread angle. Do not use on fragments.</p>
<pre><code class="language-lua">   cannon={ spread=pi*0.5 pattern=WAVE roundsPerBurst=20 burstyness=0.5

       damage=100 roundsPerSec=5 muzzleVel=50 range=50 recoil=0 }
</code></pre>
<video height=256 controls>
  <source src="diagrams/fragment_pattern_wave.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<h3 id="absolute"><a class="header" href="#absolute">Absolute</a></h3>
<p><code>pattern=ABSOLUTE</code>: bullets do not inherit velocity of ship or previous bullets. It can be mixed with any of the other pattern flags.</p>
<p>This is without <code>ABSOLUTE</code>:</p>
<pre><code class="language-lua">   cannon={ spread=0

       damage=100 roundsPerSec=5 muzzleVel=50 range=50 recoil=0 }
</code></pre>
<video height=256 controls>
  <source src="diagrams/fragment_pattern_absolute_no.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<p>This is with <code>ABSOLUTE</code>:</p>
<pre><code class="language-lua">   cannon={ spread=0 pattern=ABSOLUTE

       damage=100 roundsPerSec=5 muzzleVel=50 range=50 recoil=0 }
</code></pre>
<video height=256 controls>
  <source src="diagrams/fragment_pattern_absolute_with.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
<h2 id="explosive-flags-for-fragments"><a class="header" href="#explosive-flags-for-fragments">Explosive Flags for Fragments</a></h2>
<p>There are fragment specific alternatives for <code>ENABLED</code>, <code>FINAL</code>, and <code>PROXIMITY</code> for the <code>explosive field</code>. Respectively, they are:</p>
<ul>
<li><code>FRAG_IMPACT</code>: bullet fragments when hitting a target but not when the bullet reaches the end of its range.</li>
<li><code>FRAG_FINAL</code>: bullet fragments at either the end of its range or when the bullet's damage output is exhausted.</li>
<li><code>FRAG_PROXIMITY</code>: bullet fragments when within proximity of an attackable block.</li>
</ul>
<p>There is also <code>FRAG_NOFLASH</code>, which makes bullets with this flag spawn without producing a frag spawn particle.</p>
<p>(<a href="./cannons.html#explosive-cannons">Explosive flags for non-fragments</a>)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="cannons.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="bullet_poofs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="cannons.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="bullet_poofs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
